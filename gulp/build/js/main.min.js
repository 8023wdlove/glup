"use strict";function ActionJump(e){var t=document.getElementById("rw");console.log(123),t.style.left="20px"}function ActionRight(){var e=document.getElementById("rw"),t=(document.getElementById("rwDYM"),document.getElementById("bgRoom"));moveX+=moveSpeed,e.style.left=moveX+"%",e.offsetLeft>=t.offsetWidth&&(moveX-=moveX)}function ActionRightDYM(){var e=document.getElementById("rwDYM"),t=document.getElementById("bgRoom");moveX+=moveSpeed,e.style.left=moveX+"%",e.offsetLeft>=t.offsetWidth&&(moveX-=moveX)}function ActionTop(){function e(){$("#rw").addClass("rwAtop"),setTimeout("$('#rw').removeClass('rwAtop')",100)}function t(){$("#rw").addClass("rwAtopMore"),setTimeout("$('#rw').removeClass('rwAtopMore')",100)}var o=document.getElementById("rw"),r=o.style.left;"14%">=r&&r>="0"&&(e(),score-=1),"26%">=r&&r>"14%"&&(e(),score+=1),"38%">=r&&r>"26%"&&(e(),score+=1),"50%">=r&&r>"38%"&&(t(),score+=1),"57%">=r&&r>"50%"&&t(),"74%">=r&&r>"57%"&&e(),"87%">=r&&r>"74%"&&e(),"100%">=r&&r>"87%"&&e()}function timeLess(){time-=1,time<=0}function speedBack(){moveSpeed=.2}function changeStyle(){var e=document.getElementById("rwDYM"),t=document.getElementById("rw");return e.style.display="block",t.style.display="none",setTimeout("DYMBack()",4e3),0}function changeStyleBack(){var e=document.getElementById("rwDYM"),t=document.getElementById("rw");return e.style.display="none",t.style.display="block",1}function DYMDecreaseTime(){DYMtime>15&&(DYMtime=15),DYMtime<=15&&DYMtime>=0&&(DYMtime-=1,console.log("剩余多少时间变成大姨妈  "+DYMtime)),DYMtime<0&&(isDYM=changeStyle(),console.log("变成大姨妈了  "+isDYM))}function DYMBack(){isDYM=1,DYMtime=15,changeStyleBack()}function dym(){setTimeout("changeStyle()",1500);var e=document.getElementById("rwDYM"),t=document.getElementById("rw");return e.style.display="none",t.style.display="block",DYMtime+=15,!0}var getParam=function(e){var t=document.location.search,o=new RegExp("[?&]"+e+"=([^&]+)","g"),r=o.exec(t),n=null;if(null!=r)try{n=decodeURIComponent(decodeURIComponent(r[1]))}catch(i){try{n=decodeURIComponent(r[1])}catch(i){n=r[1]}}return n};window.mei=getParam("name");var pathname=document.location.pathname,ismeizjj=pathname.indexOf("meizjj");if(-1!=ismeizjj)switch(window.skill="7",window.four="",window.mei){case"meijia":window.four="美甲",window.skill="1";break;case"meijie":window.four="美睫",window.skill="2";break;case"meifa":window.four="美发",window.skill="6";break;case"meizhuang":window.four="美妆",window.skill="7"}else pathname.indexOf("meijia")>=0?(window.four="美甲",window.skill="1"):pathname.indexOf("meijie")>=0?(window.four="美睫",window.skill="2"):pathname.indexOf("meifa")>=0?(window.four="美发",window.skill="6"):pathname.indexOf("meizhuang")>=0&&(window.four="美妆",window.skill="7");angular.module("papabearApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate"]).config(["$routeProvider",function(e){e.when("/index",{templateUrl:"views/index.html",controller:"IndexCtrl",title:"预约"+four+"师",hideFooter:0,depth:0}).when("/product",{templateUrl:"views/product.html",controller:"ProductCtrl",title:four+"作品",hideFooter:0,depth:0}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",title:"个人中心",hideFooter:0,depth:0}).when("/product/:productId/artisan_id/:artisan_id",{templateUrl:"views/productDetail.html",controller:"ProductDetailCtrl",title:four+"图详情",showBackBtn:!0,hideFooter:!0}).when("/designer/:designerId",{templateUrl:"views/designerDetail.html",controller:"DesignerDetailCtrl",title:four+"师详情",showBackBtn:!0,hideFooter:!0}).when("/designer/info/:designerId",{templateUrl:"views/designerInfo.html",controller:"DesignerInfoCtrl",title:four+"师详情",showBackBtn:!0,hideFooter:!0}).when("/designer/comment/:designerId",{templateUrl:"views/designerComment.html",controller:"DesignerCommentCtrl",title:four+"师详情",showBackBtn:!0,hideFooter:!0}).when("/order/create/product/:productId/designer/:designerId",{templateUrl:"views/orderCreate.html",controller:"OrderCreateCtrl",title:"订单确认",showBackBtn:!0,hideFooter:!0}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",title:"登陆",showBackBtn:!0,hideFooter:!0}).when("/order",{templateUrl:"views/order.html",controller:"OrderCtrl",title:"我的订单",showBackBtn:!0,hideFooter:!0}).when("/order/confirm",{templateUrl:"views/orderConfirm.html",controller:"OrderConfirmCtrl",title:"订单创建确认",showBackBtn:!0,hideFooter:!0}).when("/order/comment/:orderId",{templateUrl:"views/orderComment.html",controller:"OrderCommentCtrl",title:"订单评价",showBackBtn:!0,hideFooter:!0}).when("/order/:orderId/:artisanId/:productId",{templateUrl:"views/orderDetail.html",controller:"OrderDetailCtrl",title:"订单详情",showBackBtn:!0,hideFooter:!0}).when("/coupon",{templateUrl:"views/coupon.html",controller:"CouponCtrl",title:"我的优惠卷",showBackBtn:!0,hideFooter:!0}).when("/collect",{templateUrl:"views/collect.html",controller:"CollectCtrl",title:"我的收藏",showBackBtn:!0,hideFooter:!0}).when("/address/search",{templateUrl:"views/addressSearch.html",controller:"AddressSearchCtrl",title:"地址搜索",showBackBtn:!0,hideFooter:!0}).when("/address/History",{templateUrl:"views/addressHistory.html",controller:"AddressHistorySearchCtrl",title:"地址历史记录",showBackBtn:!0,hideFooter:!0}).when("/city",{templateUrl:"views/city.html",controller:"CityCtrl",title:"城市选择",showBackBtn:!0,hideFooter:!0}).when("/searchDesigner",{templateUrl:"views/searchDesigner.html",controller:"DesignerSearchCtrl",title:four+"师搜索",showBackBtn:!0,hideFooter:!0}).when("/security/:designerId",{templateUrl:"views/security.html",controller:"SecurityCtrl",title:"安全认证",showBackBtn:!0,hideFooter:!0}).when("/credit",{templateUrl:"views/credit.html",controller:"CreditCtrl",title:"信用等级",showBackBtn:!0,hideFooter:!0}).when("/baiduMap",{templateUrl:"views/baiduMap.html",controller:"BaiduMapCtrl",title:"百度地图",showBackBtn:!0,hideFooter:!0}).when("/shopdetail/:shopId",{templateUrl:"views/shopDetail.html",controller:"ShopDetail",title:"店铺详情",showBackBtn:!0,hideFooter:!0}).when("/orderConfirm/DirectBook/:designerId",{templateUrl:"views/orderConfirmDirectBook.html",controller:"orderConfirmDirectBookCtrl",title:"店铺详情",showBackBtn:!0,hideFooter:!0}).when("/setting",{templateUrl:"views/setting.html",controller:"settingCtrl",title:"账户设置",showBackBtn:!0,hideFooter:!0}).when("/safety",{templateUrl:"views/safety.html",controller:"safetyCtrl",title:"安全设置",showBackBtn:!0,hideFooter:!0}).when("/changePassword/:code",{templateUrl:"views/changePassword.html",controller:"changePasswordCtrl",title:"修改支付密码",showBackBtn:!0,hideFooter:!0}).when("/recharge/:discountId/amount/:amount",{templateUrl:"views/recharge.html",controller:"rechargeCtrl",title:"充值",showBackBtn:!0,hideFooter:!0}).otherwise({redirectTo:"/index"})}]).run(["$rootScope","$route","$window","$location","Position","$cookies","Request","$cookieStore",function(e,t,o,r,n,i,a,s){if(!i.openid||""==i.openid)return void(window.location.href="../get_openid.php");e.isLogined=!(!i.token||!i.userid),e.goLogin=function(e){e?(i.loginBack=r.path(),r.path("login").replace()):(s.remove("loginBack"),delete i.loginBack,r.path("login"))},e.dataLoadCount=0,e.isLoading=0!=e.dataLoadCount,e.$on("$routeChangeSuccess",function(){window.weixinShareUrl=window.location.href,window.weixinShareContent="美丽元1",e.hideThis=t.current.hideFooter,e.title=t.current.title,wx.ready(function(){wx.onMenuShareTimeline({title:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}})})}),e.back=function(e){e?r.path(e):o.history.back()};var d=n.info();d||n.getPosition(),e.city=d.city,window.weixinShareTitle="美丽元",window.weixinShareImgUrl="http://wx.meilidoor.com/images/icon.png",window.weixinShareContent="美丽元",window.weixinShareUrl="http://wx.meilidoor.com";var c="http://"+window.location.host+window.location.pathname+window.location.search;a.get("../wxjskey.php?url="+encodeURIComponent(c)).success(function(e){console.log(e);var t=e;wx.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","previewImage"]}),wx.error(function(e){})})}]).constant("pageSize",10),angular.module("papabearApp").controller("orderConfirmDirectBookCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$location",function(e,t,o,r,n,i,a){return o.post("product/get_appoint_product",{city:"510000",ver:"3.0.0"}).success(function(e){switch(skill){case"1":t.type=e.data[0].category_id,t.price=e.data[0].price,t.img_cover=e.data[0].img_cover;break;case"2":t.type=e.data[2].category_id,t.price=e.data[2].price,t.img_cover=e.data[2].img_cover;break;case"6":t.type=e.data[4].category_id,t.price=e.data[4].price,t.img_cover=e.data[4].img_cover;break;case"7":t.type=e.data[5].category_id,t.price=e.data[5].price,t.img_cover=e.data[5].img_cover}}),r.token&&r.userid?(t.isSelf=!0,t.onOrderAddress=function(){return 6==skill?void 0:(e.orderTimeList=t.timeList,e.orderCurrent=t.current,e.orderCurrentItem=t.currentItem,e.orderUsername=t.username,e.orderMobile=t.mobile,e.orderIsSelf=t.isSelf,void a.url("address/History"))},angular.isDefined(e.orderUsername)&&(t.username=e.orderUsername),angular.isDefined(e.orderMobile)&&(t.mobile=e.orderMobile),angular.isDefined(e.orderIsSelf)&&(t.isSelf=e.orderIsSelf),t.timeList=[],t.currentTimes=[],t.setCurrent=function(e){t.current=e,e>=t.timeList.length?t.currentTimes=[]:t.currentTimes=t.timeList[e].list},t.timeSelect=function(e){var o=t.currentTimes[e];t.currentItem=e,1==o.status&&(t.selectTime=t.timeList[t.current].name+" "+t.currentTimes[e].name+":00",t.showTime=0)},angular.isUndefined(e.orderTimeList)||angular.isUndefined(e.orderCurrent)||angular.isUndefined(e.orderCurrentItem)?o.post("artisan/get_artisan_schedule",{artisan_id:i.designerId}).success(function(e){var o=0;for(var r in e.data){var n={};n.index=o,n.name=r,n.title=r.substr(5),n.status=1;var i=e.data[r];if(i){n.list=[];for(var a in i){var s={name:a,status:i[a]};1==n.status&&1==s.status&&(n.status=0),n.list.push(s)}}else n.list=[];t.timeList.push(n),o++}t.setCurrent(0)}).error(function(e){alert(e.msg)}):(t.timeList=e.orderTimeList,t.current=e.orderCurrent,t.currentItem=e.orderCurrentItem,t.setCurrent(t.current),t.timeSelect(t.currentItem)),angular.isUndefined(e.address)||(t.address=e.address,t.adressInfo=t.address.title),6==skill&&o.post("artisan/get_artisan_detail",{artisan_id:i.designerId,user_id:r.userid,token:r.token}).success(function(e){t.isMeifa=1,t.address,t.shopName=e.data.shop[0].shop_name}),void(t.orderCreate=function(){if(!t.isSelf){if(!t.username||0==t.username.length)return void alert("联系人姓名不能为空");if(!t.mobile||0==t.mobile.length)return void alert("手机号码不能为空");if(isNaN(t.mobile))return void alert("手机号码不正确");if(t.username=t.username.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,""),!t.username||""==t.username)return void alert("联系人姓名不能为特殊字符")}if(!t.selectTime||0==t.selectTime.length)return void alert("请选择预约时间");if(!t.address&&!t.shopName)return void alert("请选择服务地址");if(6==skill);else if(0==t.adressInfo.length)return void alert("请输入详细地址");var o=t.timeList[t.current],r=o.list[t.currentItem],a={address:t.isMeifa?t.shopName:t.address.address,lat:t.isMeifa?"":t.address.lat,lng:t.isMeifa?"":t.address.lng,addressInfo:t.adressInfo,isself:t.isSelf,date:o.name,hour:r.name,designerId:i.designerId,productId:i.productId,type:t.type,price:t.price,pic:t.img_cover};t.isSelf||(a.username=t.username,a.mobile=t.mobile),console.log(a),e.orderData=a,n.location.href="#/order/confirm"})):void e.goLogin(!0)}]),angular.module("papabearApp").controller("AddressHistorySearchCtrl",["$rootScope","$scope","Request","Position","pageSize","$cookies","Tool","$http","$window",function(e,t,o,r,n,i,a,s,d){var c=r.info();if(c){t.position=c;var l=c.lon,u=c.lat;console.log(c),console.log("x坐标:"+l+" y坐标:"+u),t.baiduMapFlash=function(){};var m=0;t.addresss=[],o.post("user/get_user_address",{user_id:i.userid,token:i.token,ver:"3.0"}).success(function(e){console.log(e),t.addressHistory=e,t.datas=e.data,t.addressHistoryAddress=e.data.address,console.log(e.data),e.data.address.forEach(function(e){m++,t.addressHistoryTest=e.location,t.addressHistoryX=e.latitude,t.addressHistoryY=e.longitude,t.addressHistoryAddress=e.address,t.addresss.push(e)})}),angular.isUndefined(e.address)?console.log(e.address):(console.log(e.address),console.log(e.address.title),o.post("user/add_user_address",{user_id:i.userid,token:i.token,ver:"3.0",longitude:e.address.lng,latitude:e.address.lat,location:e.address.address,address:e.address.title}).success(function(e){console.log(e)})),t.addressDetailNowChoose=e.address,console.log(e.rightFork),t.right_is_default=e.rightFork,t.chooseDefaultAddress=function(o,r){$(".last:last");console.log(o);var n=$(".defaultAddress");console.log(n),n.css("display","none"),o.target.lastElementChild.style.display="inline",e.rightFork=o.target.lastElementChild.id,t.right_is_default=e.rightFork,console.log(e.rightFork);var i={title:r.address,address:r.location,lat:r.latitude,lng:r.longitude};console.log(i),e.address=i,d.history.back()},t.adressDelete=function(){o.post("/user/del_user_address",{user_id:i.userid,token:i.token,address_id:e.rightFork,ver:"3.0.0"}).success(function(e){console.log(e),d.history.go(0)})},t.back=function(){if(angular.isUndefined(e.address)){var o={title:t.addressHistoryAddress,address:t.addressHistoryTest,lat:t.addressHistoryX,lng:t.addressHistoryY};console.log(o),e.address=o,console.log(e.address.address+e.address.title)}else console.log(e.address),console.log("地址信息的obj已经存在值");d.history.back()}}}]),angular.module("papabearApp").controller("BaiduMapCtrl",["$rootScope","$scope","Request","Position","pageSize","$cookies","Tool","$http","$window",function(e,t,o,r,n,i,a,s,d){function c(e){return document.getElementById(e)}function l(){var o=new BMap.Geocoder;o.getPoint(v,function(e){e&&(g.centerAndZoom(e,16),g.addOverlay(new BMap.Marker(e)),console.log("搜索地址后的定位"))},"北京"),g=new BMap.Map("map"),g.centerAndZoom(new BMap.Point(i.longitude,i.latitude),11),t.searchs=[];var r={onSearchComplete:function(o){n.getStatus()==BMAP_STATUS_SUCCESS?t.$apply(function(){for(var r=[],n=0;n<o.getCurrentNumPois();n++){var i=o.getPoi(n),a={title:i.title,address:i.address,lat:i.point.lat,lng:i.point.lng};r.push(a)}t.searchs=r,console.log(t.searchs),e.address=t.searchs,console.log(e.address),console.log(angular.toJson(t.searchs))}):console.log("error")}},n=new BMap.LocalSearch(g,r);n.search(v),console.log(e.address),g.addEventListener("click",function(e){console.log("当前位置："+e.point.lng+", "+e.point.lat),m=e.point.lng,p=e.point.lat,console.log(h),h.point.lng=m,h.point.lat=p,g.clearOverlays(),g.addOverlay(h),console.log("x坐标:"+m+" y坐标:"+p),_="../baiduApi.php?y="+p+"&&x="+m,s.get(_).success(function(e){console.log(e),t.positionDetail=e.result.formatted_address})}),g.addOverlay(h)}var u=r.info();if(u){if(t.position=u,angular.isUndefined(e.address)){var m=u.lon,p=u.lat;console.log(u.lon)}else{var m=u.lon,p=u.lat;console.log(e.address.lat),console.log(e.address.lng)}if(angular.isUndefined(e.addressSearch));else{var p=e.addressSearch.lat,m=e.addressSearch.lng;console.log(e.addressSearch.lat),console.log(e.addressSearch.lng)}t.positionX=m,t.positionY=p,console.log(u),console.log("x坐标:"+m+" y坐标:"+p);var g=new BMap.Map("map"),f=new BMap.Point(m,p);g.centerAndZoom(f,15);var h=new BMap.Marker(f);g.addOverlay(h),h.enableDragging(),console.log(f),h.addEventListener("load",function(e){g.addOverlay(h),h.enableDragging()}),h.addEventListener("dragend",function(e){console.log("当前位置："+e.point.lng+", "+e.point.lat),m=e.point.lng,p=e.point.lat,_="../baiduApi.php?y="+p+"&&x="+m,s.get(_).success(function(e){console.log(e),t.positionDetail=e.result.formatted_address,t.addressTitle=e.result.sematic_description})}),g.addEventListener("longpress",function(e){console.log("当前位置："+e.point.lng+", "+e.point.lat),m=e.point.lng,p=e.point.lat,console.log(h),h.point.lng=m,h.point.lat=p,g.addOverlay(h),console.log("x坐标:"+m+" y坐标:"+p),_="../baiduApi.php?y="+p+"&&x="+m,s.get(_).success(function(e){console.log(e),t.positionDetail=e.result.formatted_address,t.addressTitle=e.result.sematic_description}),t.adressInfo&&(t.adressInfo="",console.log("清空详细地址"))});var _="../baiduApi.php?y="+p+"&&x="+m;s.get(_).success(function(o){console.log(o),t.positionDetail=o.result.formatted_address,t.addressTitle=o.result.sematic_description,e.address&&(t.positionDetail=e.address.address,console.log(t.positionDetail))}),t.showDetail=function(){console.log(t.positionDetail)},t.positionSave=function(){t.adressInfo=t.addressTitle,console.log(t.positionDetail),console.log(t.adressInfo);var r={title:t.adressInfo,address:t.positionDetail,lat:p,lng:m};console.log(r),e.address=r,console.log(e.address.address+e.address.title),o.post("user/get_user_address",{user_id:i.userid,token:i.token,ver:"3.0"}).success(function(t){var o=t.data.address,r=o.pop();e.rightFork=r.address_id,console.log(e.rightFork)}),d.history.back()};var w=new BMap.Autocomplete({input:"suggestId",location:g});w.addEventListener("onhighlight",function(e){var t="",o=e.fromitem.value,r="";e.fromitem.index>-1&&(r=o.province+o.city+o.district+o.street+o.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+r,r="",e.toitem.index>-1&&(o=e.toitem.value,r=o.province+o.city+o.district+o.street+o.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+r,c("searchResultPanel").innerHTML=t});var v;w.addEventListener("onconfirm",function(e){var o=e.item.value;v=o.province+o.city+o.district+o.street+o.business,c("searchResultPanel").innerHTML="onconfirm<br />index = "+e.item.index+"<br />myValue = "+v,l(),t.positionDetail=v})}}]).controller("settingCtrl",["$rootScope","$scope","Request","$cookies","$window","pageSize","$location",function(e,t,o,r,n,i,a){t.orderBack=function(){a.path("/home")},o.post("user/get_user_info",{user_id:r.userid,token:r.token,ver:"3.3.0"}).success(function(e){t.amount=e.data.amount,t.birth=e.data.birth}),t.sure=function(){var e=document.getElementById("beginTime").value;e=e.substring(5,10),console.log(e),o.post("user/edit_user_info",{user_id:r.userid,token:r.token,ver:"3.3.0",birth:e}).success(function(e){}).error(function(e){alert(e.msg)})},o.post("order/get_order_discount",{user_id:r.userid,token:r.token,ver:"3.3.0"}).success(function(e){t.recharges=e.data,console.log(t.recharges)})}]).controller("safetyCtrl",["$rootScope","$scope","Request","$cookies","$window","pageSize","$location",function(e,t,o,r,n,i,a){t.orderBack=function(){a.path("/setting")},t.mobile="";var s;t.get_message=function(){o.post("user/get_password_code",{user_id:r.userid,token:r.token,mobile:s,ver:"3.3.0"}).success(function(e){alert(e.msg)}).error(function(e){alert(e.msg)})},t.next=function(){o.post("user/chk_password_code",{city:r.city,user_id:r.userid,token:r.token,ver:"3.3.0",code:t.code}).success(function(e){a.path("/changePassword/"+t.code)}).error(function(e){alert(e.msg)})},o.post("user/get_user_info",{user_id:r.userid,token:r.token,ver:"3.3.0"}).success(function(e){s=e.data.mobile,t.mobile=e.data.mobile,t.mobile=t.mobile.substr(0,3)+"****"+t.mobile.substr(7,11)})}]).controller("changePasswordCtrl",["$rootScope","$scope","Request","$cookies","$window","pageSize","$location","$routeParams",function(e,t,o,r,n,i,a,s){t.code=s.code,t.orderBack=function(){a.path("/safety")},t.reset=function(){o.get("../rsaencode.php?input="+t.password).success(function(e){var n=e;o.post("user/set_payment_password",{user_id:r.userid,token:r.token,ver:"3.3.0",code:t.code,password:n}).success(function(e){alert(e.msg),a.path("/home")}).error(function(e){alert(e.msg),"短信验证码错误"==e.msg&&a.path("/safety")})}).error(function(e){alert(e.msg)})}}]).controller("rechargeCtrl",["$rootScope","$scope","Request","Position","$cookies","$window","pageSize","$location","$routeParams",function(e,t,o,r,n,i,a,s,d){var c=r.info();c&&(t.amount=d.amount,o.post("user/get_user_info",{user_id:n.userid,token:n.token,ver:"3.0"}).success(function(e){t.mobile=e.data.mobile}).error(function(e){alert(e.msg),i.history.back()}),t.orderBack=function(){i.history.back()},t.recharge=function(){o.post("order/recharge",{user_id:n.userid,token:n.token,ver:"3.3.1",pay_type_id:"6",open_id:n.openid,discount_id:d.discountId,mobile:t.RecommendedMobile,city:c.cityCode}).success(function(e){}).error(function(e){alert(e.msg)})})}]).controller("IndexCtrl",["$rootScope","$scope","Request","Position","pageSize","$cookies","Tool",function(e,t,o,r,n,i,a){var s=r.info();if(s){t.city=i.city;var d=0;t.designers=[],t.loadMore=0;var c=function(){o.post("artisan/get_artisan_list",{city:s.cityCode,offset:d,size:n,latitude:s.lat,longitude:s.lon,sort:"distance",sort_type:"asc",skill:skill,ver:"3.0"}).success(function(e){t.loadMore=e.data.is_more,e.data.artisan.forEach(function(e){d++,e.level=a.getLevel(e.score),e.levelType=a.getLevelType(e.score),t.designers.push(e)})}).error(function(e){})};c(),t.loadmoreHandler=function(){c()}}}]).controller("DesignerSearchCtrl",["$rootScope","$scope","Request","Position","pageSize","$cookies","Tool",function(e,t,o,r,n,i,a){var s=r.info();if(s){t.formData={searchName:""},t.city=i.city;var d=0,c="";t.designers=[],t.loadMore=0,t.isNull=!0,t.searchDesigner=function(){0!=t.formData.searchName.length&&c!=t.formData.searchName&&(c=t.formData.searchName,d=0,t.designers=[],o.post("artisan/get_artisan_list",{keyword:t.formData.searchName,city:s.cityCode,offset:d,size:n,skill:skill,ver:"3.3.2"}).success(function(e){t.loadMore=e.data.is_more,e.data.artisan.length?(t.isNull=!0,console.log(t.isNull),e.data.artisan.forEach(function(e){d++,e.level=a.getLevel(e.score),e.levelType=a.getLevelType(e.score),t.designers.push(e)})):(t.isNull=!1,console.log(t.isNull))}).error(function(e){}))},t.loadmoreHandler=function(){t.searchDesigner()}}}]).controller("DesignerDetailCtrl",["$rootScope","$scope","$routeParams","Request","pageSize","Tool","$cookies","$location",function(e,t,o,r,n,i,a,s){console.log(angular.toJson(o));var d=0;t.type=0,t.products=[],t.loadMore=0;var c=function(){var e={city:a.cityCode,offset:d,size:n,artisan_id:o.designerId,ver:"3.0",global:"2"};1==t.type?(e.sort="price",e.sort_type="asc"):2==t.type?(e.sort="price",e.sort_type="desc"):3==t.type?(e.sort="trade_number",e.sort_type="desc"):4==t.type&&(e.sort="trade_number",e.sort_type="asc"),r.post("product/get_product_by_artisan",e).success(function(e){t.loadMore=e.data.is_more,e.data.product.forEach(function(e){e.className=d%2==0?"li_left":"li_right",d++,e.product_name.length>=7&&(e.product_name=e.product_name.substr(0,6)+"..."),t.products.push(e)})})},l={artisan_id:o.designerId};a.userid&&a.token&&(l.user_id=a.userid,l.token=a.token),r.post("artisan/get_artisan_detail",l).success(function(e){e.data.level=i.getLevel(e.data.score),e.data.levelType=i.getLevelType(e.data.score),t.designer=e.data,t.designer.comment_perfect_num=parseInt(t.designer.comment_perfect_num),t.designer.comment_medium_num=parseInt(t.designer.comment_medium_num),t.designer.comment_bad_num=parseInt(t.designer.comment_bad_num),c()}),t.loadDataDefault=function(){0!=t.type&&(t.type=0,d=0,t.products=[],t.loadMore=0,c())},t.priceAscorDesc=0,t.loadDataPrice=function(){1==t.priceAscorDesc?t.loadDataDesc():2==t.priceAscorDesc?t.loadDataAsc():0==t.priceAscorDesc&&t.loadDataAsc()},t.tradeAscorDesc=3,t.loadDataTradeNumber=function(){3==t.tradeAscorDesc?t.loadTradeAsc():4==t.tradeAscorDesc&&t.loadTradeDesc()},t.loadDataAsc=function(){t.priceAscorDesc=1,t.type=1,d=0,t.products=[],t.loadMore=0,c()},t.loadDataDesc=function(){t.priceAscorDesc=2,t.type=2,d=0,t.products=[],t.loadMore=0,c()},t.loadTradeAsc=function(){3!=t.type&&(t.tradeAscorDesc=4,t.type=3,d=0,t.products=[],t.loadMore=0,c())},t.loadTradeDesc=function(){t.tradeAscorDesc=3,t.type=4,d=0,t.products=[],t.loadMore=0,c()},t.loadmoreHandler=function(){c(),console.log(suc)},t.imgpreview=i.imgPreview,t.onCollect=function(){if(!a.token||!a.userid)return e.isLogined=!1,void e.goLogin();var o=t.designer;return angular.isUndefined(o)?(alert("数据错误"),void $window.history.back()):void(0==o.is_fav?r.post("user/fav_artisan",{user_id:a.userid,token:a.token,artisan_id:o.artisan_id,is_fav:1}).success(function(e){alert("收藏成功"),t.designer.is_fav=1}).error(function(e){alert(e.msg)}):r.post("user/fav_artisan",{user_id:a.userid,token:a.token,artisan_id:o.artisan_id,is_fav:0}).success(function(e){alert("取消收藏成功"),t.designer.is_fav=0}).error(function(e){alert(e.msg)}))},t.directBook=function(){window.location.href="#orderConfirm/DirectBook"}}]).controller("DesignerInfoCtrl",["$rootScope","$scope","$routeParams","Request","pageSize","Tool",function(e,t,o,r,n,i){console.log(angular.toJson(o));var a=0;t.comments=[],t.loadMore=0;var s=function(){r.post("comment/get_comment_by_artisan",{artisan_id:o.designerId,offset:a,size:n}).success(function(e){t.loadMore=e.data.is_more,e.data.comment.forEach(function(e){a++,t.comments.push(e)})})};r.post("artisan/get_artisan_detail",{artisan_id:o.designerId}).success(function(e){t.designer=e.data,t.designer.comment_perfect_num=parseInt(t.designer.comment_perfect_num),t.designer.comment_medium_num=parseInt(t.designer.comment_medium_num),t.designer.comment_bad_num=parseInt(t.designer.comment_bad_num),s()}),t.loadmoreHandler=function(){s()},t.imgpreview=i.imgPreview}]).controller("DesignerCommentCtrl",["$rootScope","$scope","$routeParams","Request","pageSize","Tool",function(e,t,o,r,n,i){console.log(angular.toJson(o));var a=0;t.comments=[],t.loadMore=0,t.type=0,t.isPic=0,t.isSelf=!0;var s=function(){var e={artisan_id:o.designerId,offset:a,size:n,format:t.isPic};0!=t.type&&(e.score=t.type),r.post("comment/get_comment_by_artisan",e).success(function(e){t.loadMore=e.data.is_more,0==a&&(t.num_pic=e.data.num_pic),e.data.comment.forEach(function(e){a++,t.comments.push(e)})})};r.post("artisan/get_artisan_detail",{artisan_id:o.designerId}).success(function(e){t.designer=e.data,t.designer.comment_perfect_num=parseInt(t.designer.comment_perfect_num),t.designer.comment_medium_num=parseInt(t.designer.comment_medium_num),t.designer.comment_bad_num=parseInt(t.designer.comment_bad_num),s()}),t.loadmoreHandler=function(){s()},t.setType=function(e){t.type=e,a=0,t.comments=[],s()},t.havePic=function(e){0==e?(t.isSelf=!0,a=0,t.comments=[],t.isPic=0,s()):(t.isSelf=!1,a=0,t.comments=[],t.isPic=1,s())},t.imgpreview=i.imgPreview}]).controller("ProductCtrl",["$rootScope","$scope","Request","Position","pageSize","$cookies",function(e,t,o,r,n,i){var a=r.info();if(a){t.isNoData=!0,t.city=i.city,t.type=0;var s=0;t.products=[],t.loadMore=0;var d=function(){var e={city:a.cityCode,offset:s,size:n};1==t.type?(e.sort="price",e.sort_type="asc"):2==t.type&&(e.sort="price",e.sort_type="desc"),o.post("product/get_product_list",e).success(function(e){t.loadMore=e.data.is_more,e.data.product.forEach(function(e){e.className=s%2==0?"li_left":"li_right",s++,t.products.push(e),t.isNoData=!1})})};d(),t.loadDataDefault=function(){t.isNoData=!0,t.type=0,s=0,t.products=[],t.loadMore=0,d()},t.loadDataAsc=function(){t.isNoData=!0,t.type=1,s=0,t.products=[],t.loadMore=0,d()},t.loadDataDesc=function(){t.isNoData=!0,t.type=2,s=0,t.products=[],t.loadMore=0,d()},t.loadmoreHandler=function(){d()}}}]).controller("ProductDetailCtrl",["$rootScope","$scope","Request","$routeParams","Tool","$cookies","$window","$location",function(e,t,o,r,n,i,a,s){delete e.orderTimeList,delete e.orderCurrent,delete e.orderCurrentItem,delete e.address,delete e.orderMobile,delete e.orderIsSelf,delete e.orderUsername;var d=function(e){o.post("artisan/get_artisan_detail",{artisan_id:e}).success(function(e){var o=e.data;o.level=n.getLevel(o.score),o.levelType=n.getLevelType(o.score),t.designer=o})};t.products=[];var c={product_id:r.productId};angular.isUndefined(i.userid)||angular.isUndefined(i.token)||(c.user_id=i.userid,c.token=i.token),c.artisan_id=r.artisan_id,o.post("product/get_product_detail",c).success(function(e){t.products.push(e.data),t.title=e.data.product_name;var o=r.artisan_id;d(o)}).error(function(e){alert(e.error),a.history.back()}),t.onCollect=function(){if(!i.token||!i.userid)return e.isLogined=!1,void e.goLogin();var n=t.products[0];return angular.isUndefined(n)?(alert("数据错误"),void a.history.back()):void(1==n.is_fav?o.post("user/fav_product",{user_id:i.userid,token:i.token,product_id:r.productId,is_fav:0}).success(function(e){alert("取消收藏成功"),t.products[0].is_fav=0}).error(function(e){alert(e.msg)}):o.post("user/fav_product",{user_id:i.userid,token:i.token,product_id:r.productId,is_fav:1}).success(function(e){alert("收藏成功"),t.products[0].is_fav=1}).error(function(e){alert(e.msg)}))},t.imgpreview=n.imgPreview}]).controller("LoginCtrl",["$rootScope","$scope","Request","$window","$cookies","$location",function(e,t,o,r,n,i){return n.token&&n.userid?(e.isLogined=!0,void r.history.back()):(o.get("../get_time.php").success(function(t){o.post("user/login_by_property_val",{type:1,property:n.rsaOpenid,time:t}).success(function(t){document.cookie="token="+t.data.token,document.cookie="userid="+t.data.user_id,n.token=t.data.token,n.userid=t.data.user_id,e.isLogined=!0,angular.isDefined(n.loginBack)?i.path(n.loginBack).replace():r.history.back()}).error(function(e){0==e.code&&100==e.data.stat||alert(e.msg)})}).error(function(e){alert(e.msg)}),t.mobileLogin=function(){var a=t.mobile,s=t.snscode;if(!a||0==a.length)return void alert("手机号码不能为空");var d=/^1\d{10}$/;return d.test(a)?s&&0!=s.length?void o.post("user/register_weixin",{mobile:a,code:s,open_id:n.openid,login:1}).success(function(t){document.cookie="token="+t.data.token,document.cookie="userid="+t.data.user_id,n.token=t.data.token,n.userid=t.data.user_id,e.isLogined=!0,e.$broadcast("refreshFooter"),angular.isDefined(n.loginBack)?i.path(n.loginBack).replace():r.history.back()}).error(function(e){alert(e.msg)}):void alert("验证码不能为空"):void alert("手机号码格式不正确")},t.snsbtntitle="获取验证码",t.getsnscode=function(){var e=t.mobile;if(!e||0==e.length)return void alert("手机号码不能为空");var r=/^1\d{10}$/;return r.test(e)?void(t.times>0||o.post("user/get_register_code",{mobile:e}).success(function(e){alert(e.msg),t.times=60,t.snsbtntitle=t.times+"秒";var o=function(){if(e&&clearTimeout(e),t.$apply(function(){t.snsbtntitle=t.times+"秒"}),t.times<=0)return void t.$apply(function(){t.snsbtntitle="获取验证码"});t.times=t.times-1;var e=setTimeout(o,1e3)};setTimeout(o,1e3)}).error(function(e){alert(e.msg)})):void alert("手机号码格式不正确")},t.login=function(){var a=t.mobile,s=t.password;return a&&0!=a.length?s&&0!=s.length?void o.get("../rsaencode.php?input="+s).success(function(t){o.post("user/login",{mobile:a,password:t}).success(function(t){document.cookie="token="+t.data.token,document.cookie="userid="+t.data.user_id,n.token=t.data.token,n.userid=t.data.user_id,e.isLogined=!0,e.$broadcast("refreshFooter"),angular.isDefined(n.loginBack)?i.path(n.loginBack).replace():r.history.back()}).error(function(e){alert(e.msg)})}).error(function(e){alert(e.msg)}):void alert("密码不能为空"):void alert("手机号码不能为空")},t.times=0,void(t.loginback=function(){r.history.back()}))}]).controller("OrderCreateCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$location",function(e,t,o,r,n,i,a){if(!r.token||!r.userid)return void e.goLogin(!0);t.isSelf=!0,t.onOrderAddress=function(){e.orderTimeList=t.timeList,e.orderCurrent=t.current,e.orderCurrentItem=t.currentItem,e.orderUsername=t.username,e.orderMobile=t.mobile,e.orderIsSelf=t.isSelf,a.url("address/History")},angular.isDefined(e.orderUsername)&&(t.username=e.orderUsername),
angular.isDefined(e.orderMobile)&&(t.mobile=e.orderMobile),angular.isDefined(e.orderIsSelf)&&(t.isSelf=e.orderIsSelf),t.timeList=[],t.currentTimes=[],t.setCurrent=function(e){t.current=e,e>=t.timeList.length?t.currentTimes=[]:t.currentTimes=t.timeList[e].list},t.timeSelect=function(e){var o=t.currentTimes[e];t.currentItem=e,1==o.status&&(t.selectTime=t.timeList[t.current].name+" "+t.currentTimes[e].name+":00",t.showTime=0)},angular.isUndefined(e.orderTimeList)||angular.isUndefined(e.orderCurrent)||angular.isUndefined(e.orderCurrentItem)?o.post("artisan/get_artisan_schedule",{artisan_id:i.designerId}).success(function(e){var o=0;for(var r in e.data){var n={};n.index=o,n.name=r,n.title=r.substr(5),n.status=1;var i=e.data[r];if(i){n.list=[];for(var a in i){var s={name:a,status:i[a]};1==n.status&&1==s.status&&(n.status=0),n.list.push(s)}}else n.list=[];t.timeList.push(n),o++}t.setCurrent(0)}).error(function(e){alert(e.msg)}):(t.timeList=e.orderTimeList,t.current=e.orderCurrent,t.currentItem=e.orderCurrentItem,t.setCurrent(t.current),t.timeSelect(t.currentItem)),angular.isUndefined(e.address)||(t.address=e.address,t.adressInfo=t.address.title),t.orderCreate=function(){if(!t.isSelf){if(!t.username||0==t.username.length)return void alert("联系人姓名不能为空");if(!t.mobile||0==t.mobile.length)return void alert("手机号码不能为空");if(isNaN(t.mobile))return void alert("手机号码不正确")}if(!t.selectTime||0==t.selectTime.length)return void alert("请选择预约时间");if(!t.address)return void alert("请选择服务地址");if("6"==skill){if(!t.address.shop_name)return void alert("请输入详细地址")}else if(0==t.adressInfo.length)return void alert("请输入详细地址");var o=t.timeList[t.current],r=o.list[t.currentItem],a={address:t.address.address,lat:t.address.lat,lng:t.address.lng,addressInfo:t.adressInfo,isself:t.isSelf,date:o.name,hour:r.name,designerId:i.designerId,productId:i.productId};t.isSelf||(a.username=t.username,a.mobile=t.mobile),console.log(a),e.orderData=a,n.location.href="#/order/confirm"};var s={artisan_id:i.designerId};r.userid&&r.token&&(s.user_id=r.userid,s.token=r.token),o.post("artisan/get_artisan_detail",s).success(function(e){var o=e.data.shop;o.length>0&&(t.address=o[0])})}]).controller("OrderConfirmCtrl",["$rootScope","$scope","Request","$cookies","$window","$location",function(e,t,o,r,n,i){if(!r.token||!r.userid)return void e.goLogin(!0);if(!e.orderData)return alert("订单数据不存在！"),void n.history.back();var a=function(e){var t=parseFloat(e);if(isNaN(t))return alert("function:changeTwoDecimal->parameter error"),!1;var t=Math.round(100*e)/100,o=t.toString(),r=o.indexOf(".");for(0>r&&(r=o.length,o+=".");o.length<=r+2;)o+="0";return o};t.orderData=e.orderData,e.orderData.productId?o.post("product/get_product_detail",{product_id:e.orderData.productId,artisan_id:e.orderData.designerId,ver:"3.0"}).success(function(e){t.product=e.data,t.total=t.product.price,t.$watch("myCoupon",function(e){if(e){var o=0,r=(parseFloat(t.product.price),parseFloat(e.amount),parseFloat(e.order));o=r,o=0>=o?0:o,o=0==o&&1==e.type?1:o,t.total=a(o)}else t.total=t.product.price}),t.orderData.isself&&o.post("user/get_user_info",{user_id:r.userid,token:r.token,ver:"3.0"}).success(function(e){t.orderData.username=e.data.nickname,t.orderData.mobile=e.data.mobile,t.username=t.orderData.username}).error(function(e){alert(e.msg),n.history.back()}),t.img_cover=angular.isUndefined(t.product)?t.orderData.pic:t.product.img_cover}).error(function(e){alert(e.msg),n.history.back()}):(t.total=t.orderData.price,t.img_cover=angular.isUndefined(t.product)?t.orderData.pic:t.product.img_cover,t.$watch("myCoupon",function(e){if(e){var o=0,r=(parseFloat(t.product.price),parseFloat(e.amount),parseFloat(e.order));o=r,o=0>=o?0:o,o=0==o&&1==e.type?1:o,t.total=a(o)}else t.total=t.orderData.price}),t.orderData.isself&&o.post("user/get_user_info",{user_id:r.userid,token:r.token,ver:"3.0"}).success(function(e){t.orderData.username=e.data.nickname,t.orderData.mobile=e.data.mobile,t.username=t.orderData.username}).error(function(e){alert(e.msg),n.history.back()})),t.haveCoupon=!1,t.coupons=[],o.post("order/get_usable_coupon",{user_id:r.userid,token:r.token,ver:"3.0",product_id:e.orderData.productId}).success(function(e){t.loadMore=e.data.is_more,e.data.coupon.forEach(function(e){if(0==e.amount)var o={couponId:e.coupon_id,title:e.title+"("+e.amount+")",amount:parseFloat(e.amount),type:e.type,order:e.order_price};else var o={couponId:e.coupon_id,title:e.title+"("+e.amount+")",amount:parseFloat(e.amount),type:e.type,order:e.order_price};t.coupons.push(o),t.haveCoupon=!0})}),t.username=t.orderData.username,t.submit=function(){if(t.username=t.username.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,""),!t.username||""==t.username)return void alert("用户名不能为空并且不能为特殊字符");t.remark=angular.isUndefined(t.remark)?"":t.remark,t.price=angular.isUndefined(t.product)?t.orderData.price:t.product.price;var e={artisan_id:t.orderData.designerId,user_id:r.userid,product_id:t.orderData.productId,book_type:t.orderData.isself?1:2,book_name:t.username,book_phone:t.orderData.mobile,book_date:t.orderData.date,book_hour:t.orderData.hour,longitude:t.orderData.lng,latitude:t.orderData.lat,location:t.orderData.address,address:t.orderData.addressInfo,remark:t.remark,product_price:t.price,order_price:t.total,type:t.orderData.type,token:r.token,ver:"3.0"};t.myCoupon&&0!=t.myCoupon.couponId&&(e.coupon_id=t.myCoupon.couponId),o.post("order/create",e).success(function(e){var o=e.data.order_id;n.location.href="#/order/"+o+"/"+t.orderData.designerId+"/"+t.orderData.productId}).error(function(e){alert(e.msg)})},t.showSubmitConfirm=function(){t.submit()}}]).controller("HomeCtrl",["$rootScope","$scope","Request","$cookies","$window","$location",function(e,t,o,r,n,i){return delete e.collectType,r.token&&r.userid?void o.post("user/get_user_info",{user_id:r.userid,token:r.token}).success(function(e){t.userData=e.data}).error(function(e){alert(e.msg),n.history.back()}):void e.goLogin(!0)}]).controller("OrderCtrl",["$rootScope","$scope","Request","$cookies","$window","pageSize","$location",function(e,t,o,r,n,i,a){if(!r.token||!r.userid)return void e.goLogin(!0);t.orderBack=function(){a.path("/home")},t.isNoData=!0;var s=0;t.loadMore=0,t.orders=[];var d=function(){o.post("order/get_order_by_user",{user_id:r.userid,token:r.token,offset:s,size:i}).success(function(e){t.loadMore=e.data.is_more,e.data.order.forEach(function(e){switch(t.isNoData=!1,s++,parseInt(e.order_stat)){case 0:e.statusname="待付款";break;case 1:e.statusname="支付确认中";break;case 10:e.statusname="已预约";break;case 20:e.statusname=four+"师已确认";break;case 30:e.statusname=four+"师已出发";break;case 40:e.statusname=four+"师已到达";break;case 50:e.statusname="正在"+four;break;case 60:e.statusname="服务完毕";break;case 70:e.statusname="交易完成";break;case 80:e.statusname="待取消";break;case 81:e.statusname="已取消";break;default:e.statusname=""}var o=e.book_date+"-"+e.book_hour,r=o.split("-"),n=new Date(r[0],parseInt(r[1])-1,r[2],r[3]),i=Date.parse(n),a=Date.parse(new Date),d=i-a;d=0>d?0:d,d=parseInt(d/1e3),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e};var c=parseInt(d/3600),l=parseInt(c/24),u=c%24;e.day=l,e.hour=u,t.orders.push(e)})})};d(),t.loadmoreHandler=function(){d()}}]).controller("OrderDetailCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$location","Tool",function(e,t,o,r,n,i,a,s){function d(e){var i={user_id:r.userid,token:r.token,pay_type_id:t.pay_type_id,open_id:u,coupon_id:t.couponid,password:e,order_price:t.total,account:t.UseYe};if(0==t.order.order_stat)i.order_id=t.order.order_id;else{if(!t.order.is_need_pay)return;i.order_id=t.order.addition.order_additional_id}console.log(i),o.post("order/get_transaction_data",i).success(function(e){e.data.is_pay?location.reload():(e.data.order_string||alert("支付失败"),6==t.pay_type_id&&0==t.UseYe?n.location.href=e.data.order_string:6==t.pay_type_id&&0!=t.UseYe&&(n.location.href=e.data.order_string))}).error(function(e){alert("返回的数据不正确:"+e.msg)})}if(!r.token||!r.userid)return void e.goLogin(!0);t.haveCoupon=!1,t.coupons=[],"undefined"===i.productId?i.productId=0:i.productId,o.post("order/get_usable_coupon",{user_id:r.userid,token:r.token,ver:"3.0",product_id:i.productId,order_id:i.orderId}).success(function(e){t.loadMore=e.data.is_more,e.data.coupon.forEach(function(e){if(0==e.amount)var o={couponId:e.coupon_id,title:e.title+"(￥"+e.amount+")",amount:parseFloat(e.amount),type:e.type,order:e.order_price};else var o={couponId:e.coupon_id,title:e.title+"(￥"+e.amount+")",amount:parseFloat(e.amount),type:e.type,order:e.order_price};t.coupons.push(o),t.haveCoupon=!0})}).error(function(e){console.log(e)});var c=function(e){var t=parseFloat(e);if(isNaN(t))return alert("function:changeTwoDecimal->parameter error"),!1;var t=Math.round(100*e)/100,o=t.toString(),r=o.indexOf(".");for(0>r&&(r=o.length,o+=".");o.length<=r+2;)o+="0";return o};t.orderDetailBack=function(){a.path("/order")},t.showShare=0,t.clickShowShare=function(){t.showShare=!t.showShare};var l=i.orderId;o.post("order/get_usable_amount",{user_id:r.userid,token:r.token,ver:"3.0",order_id:i.orderId}).success(function(e){t.orderYe=e.data.amount,t.order_is_pay_pwd=e.data.is_pay_pwd,o.post("order/get_order_info",{user_id:r.userid,token:r.token,order_id:l}).success(function(e){e.data.order_additional>0?(e.data.addition=e.data.order_additional_list[0],e.data.is_need_pay=0==e.data.addition.stat&&1==e.data.addition.type,e.data.total=parseFloat(e.data.amount_rmb),1==e.data.addition.type?e.data.total+=parseFloat(e.data.addition.amount):2==e.data.addition.type&&(e.data.total-=parseFloat(e.data.addition.amount)),e.data.total=c(e.data.total)):(e.data.is_need_pay=!1,e.data.total=e.data.amount_rmb),t.order=e.data,t.total=t.order.amount_rmb;var n=t.total;t.$watch("myCoupon",function(e){e?(t.order.amount_rmb=e.order,parseFloat(t.orderYe)>=parseFloat(t.order.amount_rmb)?(t.UseYe=c(t.order.amount_rmb),c(parseFloat(t.orderYe)-parseFloat(t.order.amount_rmb))>=0?(t.total="0.00",t.pay_type_id=5):alert("价格错误")):(t.UseYe=t.orderYe,t.total=-(parseFloat(t.orderYe)-parseFloat(t.order.amount_rmb)),t.total=c(t.total),t.pay_type_id=6),t.couponid=e.couponId):(t.total=t.order.amount_rmb=n,parseFloat(t.orderYe)>=parseFloat(t.order.amount_rmb)?(t.UseYe=c(t.order.amount_rmb),c(parseFloat(t.orderYe)-parseFloat(t.order.amount_rmb))>=0?(t.total="0.00",t.pay_type_id=5):alert("价格错误")):(t.UseYe=t.orderYe,t.total=-(parseFloat(t.orderYe)-parseFloat(t.order.amount_rmb)),t.total=c(t.total),t.pay_type_id=6),1==t.order.is_account&&(t.total=t.order.amount_rmb-t.order.amount_account,t.total=c(t.total))),0!=t.order.order_additional&&(t.SecondUseYe=c(t.order.order_additional_list[0].amount-t.order.order_additional_list[0].amount_account),parseFloat(t.orderYe)>=parseFloat(t.order.order_additional_list[0].amount)?(t.UseYe=c(t.order.order_additional_list[0].amount),c(parseFloat(t.orderYe)-parseFloat(t.order.order_additional_list[0].amount))>=0?(t.total="0.00",t.pay_type_id=5):alert("价格错误"),t.DFtotal="0.00"):(t.UseYe=t.orderYe,t.total=-(parseFloat(t.orderYe)-parseFloat(t.order.order_additional_list[0].amount)),t.total=c(t.total),t.pay_type_id=6,t.DFtotal=-(parseFloat(t.orderYe)-parseFloat(t.SecondUseYe)),t.DFtotal=c(t.DFtotal)),0!=t.order.order_additional_list[0].amount_account&&(t.SecondUseYe=c(t.order.order_additional_list[0].amount-t.order.order_additional_list[0].amount_account),parseInt(t.orderYe)>=parseInt(t.UseYe)&&(parseFloat(t.orderYe)>=parseFloat(t.SecondUseYe)?(t.UseYe=c(t.SecondUseYe),c(parseFloat(t.orderYe)-parseFloat(t.SecondUseYe))>=0?(t.total="0.00",t.pay_type_id=5):alert("价格错误"),t.DFtotal="0.00"):(t.UseYe=t.orderYe,t.total=-(parseFloat(t.orderYe)-parseFloat(t.SecondUseYe)),t.total=c(t.total),t.pay_type_id=6,t.DFtotal=-(parseFloat(t.orderYe)-parseFloat(t.SecondUseYe)),t.DFtotal=c(t.DFtotal)))))});var i=e.data.book_date+"-"+e.data.book_hour,a=i.split("-"),s=new Date(a[0],parseInt(a[1])-1,a[2],a[3]),d=Date.parse(s),u=Date.parse(new Date),m=d-u;m=0>m?0:m,m=parseInt(m/1e3),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e};var p=parseInt(m/3600),g=parseInt(p/24),f=p%24;t.order.day=g,t.order.hour=f;var h=[],_=!1;t.order.order_additional>0&&(_=t.order.addition);var w=parseFloat(t.order.amount_rmb);if(1==t.order.pay_stat)if(0==_)h.push("(退款金额"+_.amount+"元)");else{var v=parseFloat(t.order.amount),y=parseFloat(_.amount);w+y!=v&&h.push("(退款金额"+_.amount+"元)")}else if(2==t.order.pay_stat)if(h.push("退款已完成"),0==_)h.push("(退款金额"+t.order.amount_rmb+"元)");else{var y=parseFloat(_.amount);y!=w?h.push("(退款金额"+_.amount+"元)"):h.push("(退款金额"+_.amount+"元)")}t.order.cancelStrings=h,70==t.order.order_stat&&0!=t.order.is_comment&&o.post("user/share_user_coupon",{user_id:r.userid,token:r.token,order_id:l,share_type:"weixin"}).success(function(e){window.weixinShareUrl=e.data.url,window.weixinShareContent=e.data.msg,wx.onMenuShareTimeline({title:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:window.weixinShareTitle,desc:window.weixinShareContent,link:window.weixinShareUrl,imgUrl:window.weixinShareImgUrl,success:function(){},cancel:function(){}})})}).error(function(e){alert(e.msg),n.history.back()})}),t.orderCancel=function(){var o="确定取消订单吗？";30==t.order.order_stat&&(o=four+"师已出发，若取消订单，将扣除50元交通费"),e.isShowAutoConfirm=!0,e.autoConfirmContent=o,e.confirmSureFunc=function(){t.confirmSure()};var r;(r=document.getElementById("pay"))&&(r.style.zIndex="0")},t.confirmSure=function(){o.post("order/cancel",{user_id:r.userid,token:r.token,order_id:t.order.order_id}).success(function(e){alert("取消订单成功"),n.location.reload()}).error(function(e){alert(e.msg)})},t.orderFinish=function(){o.post("order/confirm",{user_id:r.userid,token:r.token,order_id:t.order.order_id}).success(function(e){var o=!t.order.is_need_pay&&t.order.order_additional>0&&0==t.order.addition.stat?"提交退款请求成功":"订单确认成功";alert(o),n.location.reload()}).error(function(e){alert(e.msg)})},t.password,t.determine=function(){console.log(t.password),o.get("../rsaencode.php?input="+t.password).success(function(e){d(e)})};var u=r.openid;t.orderWxPay=function(){5==t.pay_type_id?1==t.order_is_pay_pwd?(document.getElementById("input").style.display="block",document.getElementById("pay").style.zIndex="0"):d():6==t.pay_type_id&&0!=t.UseYe?1==t.order_is_pay_pwd?(document.getElementById("input").style.display="block",document.getElementById("pay").style.zIndex="0"):d():6==t.pay_type_id&&0==t.UseYe&&d()},t.onPhone=function(){angular.isUndefined(t.mobile)?o.post("artisan/get_artisan_detail",{artisan_id:t.order.artisan_id,user_id:r.userid,token:r.token}).success(function(e){t.designer=e.data,o.get("../rsadecode.php?input="+encodeURIComponent(e.data.mobile)).success(function(e){t.mobile=e,n.location.href="tel:"+t.mobile}).error(function(e){alert("网络连接失败")})}).error(function(e){alert(e.msg)}):n.location.href="tel:"+t.mobile},t.timeList=[],t.currentTimes=[],t.setCurrent=function(e){t.current=e,e>=t.timeList.length?t.currentTimes=[]:t.currentTimes=t.timeList[e].list},t.timeSelect=function(n){var i=t.currentTimes[n];if(t.currentItem=n,1==i.status){var a=t.timeList[t.current],s=a.list[t.currentItem];t.showTime=!1,e.isShowAutoConfirm=!0,e.autoConfirmContent="是否确认修改预约时间？",e.confirmSureFunc=function(){o.post("order/reset_order_time",{user_id:r.userid,token:r.token,order_id:t.order.order_id,book_date:a.name,book_hour:s.name}).success(function(e){alert("修改服务时间成功"),t.order.book_date=a.name,t.order.book_hour=s.name,t.timeList=[],t.currentTimes=[]}).error(function(e){alert(e.msg)})}}},t.modifyTime=function(){0==t.timeList.length?o.post("artisan/get_artisan_schedule",{artisan_id:t.order.artisan_id}).success(function(e){var o=0;for(var r in e.data){var n={};n.index=o,n.name=r,n.title=r.substr(5),n.status=1;var i=e.data[r];if(i){n.list=[];for(var a in i){var s={name:a,status:i[a]};1==n.status&&1==s.status&&(n.status=0),n.list.push(s)}}else n.list=[];t.timeList.push(n),o++}t.setCurrent(0),t.showTime=!0}).error(function(e){alert(e.msg)}):t.showTime=!0}}]).controller("OrderCommentCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$location",function(e,t,o,r,n,i,a){if(!r.token||!r.userid)return void e.goLogin(!0);var s=i.orderId;o.post("order/get_order_info",{user_id:r.userid,token:r.token,order_id:s}).success(function(e){e.data.order_additional>0?(e.data.addition=e.data.order_additional_list[0],e.data.is_need_pay=0==e.data.addition.stat&&1==e.data.addition.type):e.data.is_need_pay=!1,t.order=e.data;var o=e.data.book_date+"-"+e.data.book_hour,r=o.split("-"),n=new Date(r[0],parseInt(r[1])-1,r[2],r[3]),i=Date.parse(n),a=Date.parse(new Date),s=i-a;s=0>s?0:s,s=parseInt(s/1e3),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e};var d=parseInt(s/3600),c=parseInt(d/24),l=d%24;t.order.day=c,t.order.hour=l}).error(function(e){alert(e.msg),n.history.back()}),t.professional=5,t.setProfessional=function(e){e==t.professional&&e--,t.professional=e},t.getProfessionalTitle=function(){return 0==t.professional?"非常差":1==t.professional?"比较差":2==t.professional?"还行吧":3==t.professional?"一般哦":4==t.professional?"比较好":5==t.professional?"非常好":""},t.communication=5,t.setCommunication=function(e){e==t.communication&&e--,t.communication=e},t.getCommunicationTitle=function(){return 0==t.communication?"非常差":1==t.communication?"比较差":2==t.communication?"还行吧":3==t.communication?"一般哦":4==t.communication?"比较好":5==t.communication?"非常好":""},t.punctuality=5,t.setPunctuality=function(e){e==t.punctuality&&e--,t.punctuality=e},t.getPunctualityTitle=function(){return 0==t.punctuality?"非常差":1==t.punctuality?"比较差":2==t.punctuality?"还行吧":3==t.punctuality?"一般哦":4==t.punctuality?"比较好":5==t.punctuality?"非常好":""},t.onsubmit=function(){if(!t.content||0==t.content.length)return void alert("评价内容不能为空");var e={user_id:r.userid,order_id:s,content:t.content,professional:t.professional,communication:t.communication,punctuality:t.punctuality,score:t.score,token:r.token};o.post("comment/submit",e).success(function(e){alert("评价成功"),n.history.back()}).error(function(e){alert(e.msg)})}}]).controller("CouponCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","pageSize","$location",function(e,t,o,r,n,i,a,s){if(!r.token||!r.userid)return void e.goLogin(!0);t.isNoData=!0;var d=0;t.loadMore=0,t.coupons=[];var c=function(){o.post("user/get_coupon_list",{user_id:r.userid,token:r.token,offset:d,size:a,stat:t.stat}).success(function(e){t.loadMore=e.data.is_more,e.data.coupon.forEach(function(e){t.isNoData=!1,d++,"1"==e.stat?e.bgindex="1":e.bgindex="3",e.amount=parseInt(e.amount);for(var o=e.category.split(","),r=0;r<o.length;r++)switch(o[r]){case"1":o[r]="美甲";break;case"2":o[r]="美足";break;case"3":o[r]="美睫";break;case"4":o[r]="脱毛";break;case"5":o[r]="护理";break;case"6":o[r]="美发";break;case"7":o[r]="美妆";break;case"0":o[r]="全场适用"}e.category=o.join(),t.coupons.push(e)})})};t.setStat=function(e){t.isNoData=!0,t.stat=e,t.coupons=[],t.loadMore=0,d=0,c()},t.loadmoreHandler=function(){c()},t.setStat(12),t.exchangeShow=!1,t.exchangeFail=function(){t.exchangeShow=!1},t.exchangeSure=function(){return t.exchangeShow=!1,""==t.exchange?void alert("兑换码不能为空"):void o.post("user/cdkey",{user_id:r.userid,token:r.token,cdkey:t.exchange}).success(function(e){alert("兑换成功"),t.setStat(t.stat),t.exchange=""}).error(function(e){alert(e.msg),t.exchange=""})}}]).controller("CollectCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","pageSize","$location","Tool",function(e,t,o,r,n,i,a,s,d){if(!r.token||!r.userid)return void e.goLogin(!0);t.isNoData=!0;var c=0;t.loadMore=0,t.datas=[];var l=function(){0==t.type?o.post("user/get_fav_artisan_list",{user_id:r.userid,token:r.token,offset:c,size:a}).success(function(e){t.loadMore=e.data.is_more,e.data.artisan.forEach(function(e){c++,e.level=d.getLevel(e.score),e.levelType=d.getLevelType(e.score),t.datas.push(e),t.isNoData=!1})}):o.post("user/get_fav_product_list",{user_id:r.userid,token:r.token,offset:c,size:a}).success(function(e){t.loadMore=e.data.is_more,e.data.product.forEach(function(e){e.className=c%2==0?"li_left":"li_right",c++,t.datas.push(e),t.isNoData=!1,console.log(e.artisan_id),o.post("product/get_product_detail",{artisan_id:"0",user_id:r.userid,token:r.token,latitude:r.latitude,longitude:r.longitude,product_id:e.product_id,ver:"3.3.2",city:r.cityCode}).success(function(t){console.log(t.data.product_type),2==t.data.product_type&&(e.artisan_id=t.data.suggest_artisan_id)})})})};t.setType=function(o){t.isNoData=!0,t.type=o,e.collectType=o,t.datas=[],t.loadMore=0,c=0,l()},t.loadmoreHandler=function(){l()},angular.isDefined(e.collectType)?t.setType(e.collectType):t.setType(0)}]).controller("AddressSearchCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","pageSize","$interval",function(e,t,o,r,n,i,a,s){t.keywordFocus=!1,s(function(){t.keywordFocus=!t.keywordFocus},1500,1);var d=new BMap.Map("allmap");d.centerAndZoom(new BMap.Point(r.longitude,r.latitude),11),t.searchs=[],t.change=function(){if(t.searchs=[],""!=t.keyword){var e={onSearchComplete:function(e){o.getStatus()==BMAP_STATUS_SUCCESS?t.$apply(function(){for(var o=[],r=0;r<e.getCurrentNumPois();r++){var n=e.getPoi(r),i={title:n.title,address:n.address,lat:n.point.lat,lng:n.point.lng};o.push(i)}t.searchs=o,console.log(angular.toJson(t.searchs))}):console.log("error")}},o=new BMap.LocalSearch(d,e);o.search(t.keyword)}},t.itemSelect=function(o){e.address=t.searchs[o],e.addressSearch=t.searchs[o],console.log(e.address),console.log(t.keyword),n.history.back()}}]).controller("CityCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$cookieStore",function(e,t,o,r,n,i,a){t.locationCity=r.city,t.citys=[],o.post("service/get_city_list").success(function(e){e.data.city.forEach(function(e){t.citys.push(e)})}).error(function(e){alert(e.msg)}),t.select=function(e){var o=t.citys[e];r.city=o.name,r.cityCode=o.code,t.locationCity=o.name}}]).controller("SecurityCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$cookieStore",function(e,t,o,r,n,i,a){o.post("artisan/certificate",{artisan_id:i.designerId}).success(function(e){t.certificate=e.data})}]).controller("CreditCtrl",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$cookieStore",function(e,t,o,r,n,i,a){}]).controller("ShopDetail",["$rootScope","$scope","Request","$cookies","$window","$routeParams","$cookieStore",function(e,t,o,r,n,i,a){var s=function(){o.post("shop/get_shop_detail",{shop_id:i.shopId,ver:"3.0"}).success(function(e){console.log(e),t.shop=e.data}).error(function(e){})};s()}]),angular.module("papabearApp").directive("zmFooter",function(){return{scope:{hideThis:"@"},controller:["$scope","$timeout","$rootScope","$route","$location",function(e,t,o,r,n){e.items=[];var i=function(){e.items=[],e.items.push({title:"选"+four+"师",link:"/index",imgtag:"26"}),e.items.push({title:"个人中心",link:"/home",imgtag:"31"})};i();var a;e.changeStage=function(t){e.currentIndex=t},o.$on("refreshFooter",function(e,t){i()}),o.$on("$routeChangeSuccess",function(t,o){a=angular.isDefined(o.depth)?o.depth:"",e.currentIndex=a}),e.url=function(){return n.url()}}],template:'<a href="#{{item.link}}" ng-repeat="item in items"  ng-click="changeStage($index)"><div class="ft-part" ng-class="{current:url()==item.link}"><img ng-src="images/pp_{{item.imgtag}}.png" alt="" class="pic01"><img ng-src="images/bb_26.png" alt="" class="pic02"><br/><em>{{item.title}}</em></div>',link:function(e,t){e.$watch("hideThis",function(e){"true"===e?t.css("visibility","hidden"):t.css("visibility","visible")})}}}).directive("zmScroll",["$rootScope","Util",function(e,t){return{restrict:"A",replace:!0,transclude:!0,template:'<div class="scrollWrapper"><div class="scroll"><div ng-transclude></div></div></div>',link:function(e,o,r){var n="true"==r.srcrollRef,i="true"==r.scrollLazyload,a=null;o[0].querySelector(".loading"),e.loading=!1,e.hasMore=!0;var s=function(){var o=t.getWidth_height();console.log(o),i&&e.$broadcast("loadImg",o)};window.onscroll=n||i?function(){a&&clearTimeout(a),e.hasMore&&!e.loading&&(a=setTimeout(function(){s()},1e3))}:null;var d;"true"===r.noBottom&&o.addClass("noBottom"),window.addEventListener("resize",function(){d&&clearTimeout(d),d=setTimeout(function(){},500)})}}}]).directive("lazyloadSrc",["Util",function(e){return{restrict:"AE",compile:function(){var t=function(e,t,o,r){if(!t.hasClass("lazyload")&&!t.data("loaded")){var n=new Image;n.src="./images/loading.png",n.style.height="100%",n.style.width="100%",n.style.maxHeight="200px",t.html(""),t.append(n)}if(!t.data("loaded")&&!t.hasClass("show")){var i=t[0].getBoundingClientRect();if(i.top>0&&i.bottom<r.clientHeight+150){var a=new Image;a.onload=function(){t.data("loaded",!0),a.style.height="100%",a.style.width="100%",t.html(""),t.append(a),t.addClass("show"),t.removeClass("lazyload")},a.onerror=function(){a.src="./images/default_avatar.jpg",t.html(""),t.removeClass("lazyload"),t.data("loaded",!1),t.removeClass("show")},""==o.lazyloadSrc?a.src="./images/default_avatar.jpg":a.src=o.lazyloadSrc}}};return function(o,r,n){t(o,r,n,e.getWidth_height()),o.$on("loadImg",function(e,i){t(o,r,n,i)})}}}}]).directive("autoFocusWhen",["$log","$timeout",function(e,t){return{restrict:"A",scope:{autoFocusWhen:"="},link:function(e,o){e.$watch("autoFocusWhen",function(e){e&&t(function(){var e=document.getElementById("keyword");e.focus()})})}}}]).directive("autoConfirm",["$log","$timeout","$rootScope",function(e,t,o){return{restrict:"A",scope:{autoConfirm:"="},link:function(e,t){e.$watch("autoConfirm",function(e){e?t[0].style.display="":t[0].style.display="none"}),o.autoConfirmFail=function(){t[0].style.display="none",o.isShowAutoConfirm=!1},o.autoConfirmSure=function(e){t[0].style.display="none",o.isShowAutoConfirm=!1,angular.isDefined(e)&&e()}}}}]).directive("autoAlert",["$log","$timeout","$rootScope",function(e,t,o){return{restrict:"A",scope:{autoAlert:"="},link:function(e,t){e.$watch("autoAlert",function(e){e?t.removeClass("ng-hide"):t.addClass("ng-hide")}),o.autoAlertFail=function(){t.addClass("ng-hide"),o.isShowAutoAlert=!1},o.autoAlertSure=function(e){t.addClass("ng-hide"),o.isShowAutoAlert=!1,angular.isDefined(e)&&e()}}}}]).directive("containerBackground",function(){return{restrict:"EA",scope:{title:"=expanderTitle"},template:"<div>123</div>",transclude:!0,link:function(e,t,o){e.showMe=!1,e.toggle=function(){e.showMe=!e.showMe},angular.element(document.querySelector("div")).addClass("we")}}}),angular.module("papabearApp").service("Position",["Request","$cookies","$window","$rootScope",function(e,t,o,r){var n={info:function(){return t.longitude&&t.latitude&&t.city&&t.cityCode?{lon:t.longitude,lat:t.latitude,city:t.city,cityCode:t.cityCode}:!1},getPosition:function(){if(!t.citylist)return void e.post("service/get_city_list").success(function(e){console.log(angular.toJson(e)),t.citylist=angular.toJson(e.data.city),o.location.reload()}).error(function(e){alert(e.msg)});if(!(t.longitude&&t.latitude&&t.city&&t.cityCode)){r.dataLoadCount++,r.isLoading=0!=r.dataLoadCount;var n=new BMap.Geolocation;n.getCurrentPosition(function(e){r.dataLoadCount--,r.isLoading=0!=r.dataLoadCount;var n=function(e,t){var o=30,r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()};if(this.getStatus()==BMAP_STATUS_SUCCESS){console.log("定位信息："+angular.toJson(e.point)),console.log("定位信息："+angular.toJson(e.address)),n("longitude",e.point.lng),n("latitude",e.point.lat);for(var i,a,s=angular.fromJson(t.citylist),d=0;d<s.length;d++){var c=s[d];if(0==d&&(i=c.name,a=c.code),c.name==e.address.city){i=c.name,a=c.code;break}}n("city",i),n("cityCode",a),window.location.reload()}else{var s=angular.fromJson(t.citylist),c=s[0];n("longitude",c.longitude),n("latitude",c.latitude),n("city",c.name),n("cityCode",c.code),alert("定位失败"),o.location.reload()}},{enableHighAccuracy:!0})}},cityList:function(){return t.citylist?angular.fromJson(t.citylist):null},setCookie:function(e){t.longitude=e.lon,t.latitude=e.lat,t.city=e.city,t.cityCode=e.cityCode}};return n}]).service("Tool",[function(){var e={getLevel:function(e){var t=e,o=0;return 2>t?o=1:t>=2&&3>=t?o=2:t>=4&&8>=t?o=3:t>=9&&14>=t?o=4:t>=15&&30>=t?o=5:t>=31&&57>=t?o=1:t>=58&&93>=t?o=2:t>=94&&146>=t?o=3:t>=147&&210>=t?o=4:t>=211&&285>=t?o=5:t>=286&&384>=t?o=1:t>=385&&507>=t?o=2:t>=508&&655>=t?o=3:t>=656&&828>=t?o=4:t>=829&&1025>=t?o=5:t>=1026&&1306>=t?o=1:t>=1307&&1643>=t?o=2:t>=1644&&2036>=t?o=3:t>=2037&&2485>=t?o=4:t>=2486&&2990>=t?o=5:t>=2991&&3607>=t?o=1:t>=3608&&4336>=t?o=2:t>=4337&&5177>=t?o=3:t>=5178&&6130>=t?o=4:t>=6131&&7195>=t?o=5:t>=7196&&(o=5),o},getLevelType:function(e){return 0},imgPreview:function(e,t){e||(e=""),t||(t=[]),wx.previewImage({current:e,urls:t})}};return e}]).service("Request",["$http","$cookies","$rootScope","$window","$cookieStore","$location",function(e,t,o,r,n,i){var a={post:function(r,a,s){o.dataLoadCount++,o.isLoading=0!=o.dataLoadCount;var d="../turn.php?api="+encodeURIComponent(r);console.log("[http requestURL]:"+r);var c="{}";angular.isDefined(a)&&(c=angular.toJson(a)),console.log("[http requestJson]:"+c),d+="&data="+encodeURIComponent(c);var l={error:function(e){this.fun=e},fun:function(e){}},s={success:function(e){return this.fun=e,l},fun:function(e){}};return e.get(d).success(function(e,r,a,d){o.dataLoadCount--,o.isLoading=0!=o.dataLoadCount,console.log("[http success responseData]:"+angular.toJson(e));var c={code:e.state.code,msg:e.state.msg,data:e.data};if(1==c.code)s.fun(c);else{if(99==c.code)return alert(c.msg),n.remove("token"),n.remove("userid"),delete t.token,delete t.userid,o.isLogined=!1,o.$broadcast("refreshFooter"),void i.path("login");l.fun(c)}}).error(function(e,t,r,n){o.dataLoadCount--,o.isLoading=0!=o.dataLoadCount,console.log("[http error responseData]:"+angular.toJson(e));var i={code:0,msg:"网络请求失败",data:{}};l.fun(i)}),s},get:function(t,r){o.dataLoadCount++,o.isLoading=0!=o.dataLoadCount;var n={error:function(e){this.fun=e},fun:function(e){}},r={success:function(e){return this.fun=e,n},fun:function(e){}};return e({method:"GET",url:t}).success(function(e,t,n,i){o.dataLoadCount--,o.isLoading=0!=o.dataLoadCount,console.log("[http success responseData]:"+e);r.fun(e)}).error(function(e,t,r,i){o.dataLoadCount--,o.isLoading=0!=o.dataLoadCount,console.log("[http error responseData]:"+angular.toJson(e));var a={code:0,msg:"网络请求失败",data:""};n.fun(a)}),r}};return a}]),angular.module("papabearApp").factory("Util",[function(){
function e(e){return r||(r=angular.element(document.createElement("div"))),angular.element(document.getElementsByTagName("body")).append(r),r.attr("class","mask"),e&&setTimeout(function(){r.on("click",o)},600),r}function t(){var e=0,t=0,o=0;return document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),t=document.body.clientHeight&&document.documentElement.clientHeight?document.body.clientHeight<document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight:document.body.clientHeight>document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),{scrollTop:e,clientHeight:t,scrollHeight:o}}function o(){r&&(r.off("click",o),r.html("").remove())}var r;return{time2day:function(e){var t=new Date(e);return{year:t.getFullYear(),mon:t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,day:t.getDate()<10?"0"+t.getDate():t.getDate(),hour:t.getHours()<10?"0"+t.getHours():t.getHours(),min:t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}},showGuide:function(t){var o=window.localStorage.getItem(t);o||(window.localStorage.setItem(t,!0),e(!0).addClass(t))},showBigImg:function(){return e(!0)},isIOS7:function(){var e=window.navigator.userAgent;return/iphone\s+os\s+7_?/gi.test(e)},showMsg:function(){e(!1)},removeMask:o,getWidth_height:t}}]),moveX=0,moveSpeed=.1,score=0,time=60,DYMtime=15,isDYM=1,setInterval("ActionRight()",10),setInterval("ActionRightDYM()",10),setInterval("DYMDecreaseTime()",1e3),window.onload=function(){};var myApp=angular.module("myAppp",[]);myApp.controller("personController",function(e){e.person={firstName:"John",lastName:"Doe",fullName:function(){var t=e.person;return t.firstName+" "+t.lastName}},e.name="yjl",e.scoreFS=0,e.rw="img/玛丽游戏中奔跑.gif",e.rwDYM="img/玛丽-来了大姨妈2.gif",setInterval("timeLess()",1e3),setInterval("console.log(time)",1e3),e.time=time,e.score=function(){function t(){$("#rw").addClass("rwAtop"),setTimeout("$('#rw').removeClass('rwAtop')",100)}function o(){$("#rw").addClass("rwAtopMore"),setTimeout("$('#rw').removeClass('rwAtopMore')",100)}if(isDYM){var r=document.getElementById("rw"),n=r.style.left;"14%">=n&&n>="-12%"&&(t(),e.scoreFS-=1),"26%">=n&&n>"14%"&&(t(),e.scoreFS+=1),"38%">=n&&n>"26%"&&(t(),e.scoreFS+=1),"50%">=n&&n>"38%"&&(o(),e.scoreFS+=1),"57%">=n&&n>"50%"&&(o(),e.scoreFS+=1,moveSpeed=.2,DYMtime+=15,setTimeout("speedBack()",15e3)),"74%">=n&&n>"57%"&&(t(),e.scoreFS+=1),"87%">=n&&n>"74%"&&(t(),e.scoreFS-=1),"100%">=n&&n>"87%"&&t()}}});